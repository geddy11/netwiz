<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Network Wizard for VHDL Test Benches: PCAP library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="netwiz.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Network Wizard for VHDL Test Benches
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('nw_pcap.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PCAP library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PCAP">PCAP</a><ul><li class="level2"><a href="#pcap_subsec1">Functionality</a></li>
<li class="level2"><a href="#pcap_subsec2">Limitations</a></li>
<li class="level2"><a href="#pcap_subsec3">Example use</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="PCAP"></a>
PCAP</h1>
<p>The PCAP library provides functions for reading network packets from PCAP files captured by <code>tcpdump</code>, <code>Wireshark</code> etc. These packets can then be used as stimuli in test benches. A collection of PCAP files can be found at for example <a href="https://packetlife.net/captures/">PacketLife</a>.</p>
<h2><a class="anchor" id="pcap_subsec1"></a>
Functionality</h2>
<ul>
<li>Read network packets from PCAP and PCAPNG files </li>
<li>Count captured packets in PCAP/PCAPNG files</li>
</ul>
<h2><a class="anchor" id="pcap_subsec2"></a>
Limitations</h2>
<ul>
<li>No support for reading metadata (use e.g. Wireshark to explore PCAP files). </li>
<li>Only first section in PCAPNG files can be accessed.</li>
</ul>
<p><br  />
 More details in <a class="el" href="classnw__pcap__pkg.html">nw_pcap_pkg</a> </p>
<h2><a class="anchor" id="pcap_subsec3"></a>
Example use</h2>
<p>Include the libraries: </p><div class="fragment"><div class="line">library nw_util;</div>
<div class="line">context nw_util.nw_util_context;</div>
<div class="line">library nw_pcap;</div>
<div class="line">use nw_pcap.nw_pcap_pkg.all;</div>
</div><!-- fragment --><p> Define file name of PCAP file: </p><div class="fragment"><div class="line">constant C_FNAME : string := &quot;/home/user/ddos_attack.pcap&quot;;</div>
</div><!-- fragment --><p> Now, assume we have a procedure called <code>schedule_pkt()</code> that will send a packet across an interface to the DUT. Such procedures are readily available in verification frameworks like <a href="https://github.com/UVVM/UVVM">UVVM</a>. The code below will schedule all the network packets in the PCAP file for transmission in the test bench: </p><div class="fragment"><div class="line">for i in 0 to f_pcap_get_pkt_cnt(C_FNAME) - 1 loop</div>
<div class="line">  schedule_pkt(f_pcap_get_pkt(C_FNAME, i, f_pcap_get_pkt_len(C_FNAME, i)));</div>
<div class="line">end loop;</div>
</div><!-- fragment --><p> The packets in PCAP files do not always contain all the information normally transmitted on a physical link. For example captured ethernet packets do not have preamble and often not the FCS. NetWiz can fix this for supported network protocols. Include ethernet library to fix captured ethernet packets: </p><div class="fragment"><div class="line">library nw_ethernet;</div>
<div class="line">use nw_ethernet.nw_ethernet_pkg.all;</div>
</div><!-- fragment --><p> Add preamble and FCS to packets before scheduling: </p><div class="fragment"><div class="line">for i in 0 to f_pcap_get_pkt_cnt(C_FNAME) - 1 loop</div>
<div class="line">  v_len                     := f_pcap_get_pkt_len(C_FNAME, i); -- get length of packet #i</div>
<div class="line">  array_8bit(0 to v_len -1) := f_pcap_get_pkt(C_FNAME, i, v_len); -- get packet</div>
<div class="line">  v_header                  := f_eth_get_header(array_8bit(0 to v_len - 1)); -- extract header</div>
<div class="line">  v_header.mac_dest         := f_eth_mac_2_slv_arr(&quot;a2:34:56:f1:30:00&quot;); -- maybe modify the header</div>
<div class="line">  schedule_pkt(f_concat(C_ETH_PREAMBLE, f_eth_create_pkt(v_header, f_eth_get_payload(array_8bit(0 to v_len -1))))); -- add preamble and FCS</div>
<div class="line">end loop;</div>
</div><!-- fragment --><p> See further examples in the test bench nw_pcap_tb.vhd. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
